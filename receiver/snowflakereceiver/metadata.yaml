name: snowflakereceiver

# every meter will have these attributes
resource_attributes:
  snowflake.account.name:
    description: The name of the snowflake account being monitored
    type: string
  snowflake.warehouse.name:
    description: The name of the warehouse being used
    type: string
  snowflake.username:
    description: The name of the snowflake user account being used
    type: string

attributes:
  service_type:
    description: Service type
    type: string
  error_message:
    description: Error message if present
    type: string 
  reported_client_type:
    description: Client type used for attempt
    type: string
  is_success:
    description: Login status
    type: string
  schema_name:
    description: name of schema 
    type: string
  # this should probably be an enum, investigate
  execution_status:
    description: execution status 
    type: string
  query_type:
    description: type of query performed
    type: string
  database_name:
    description: name of database (default is snowflake)
    type: string
  warehouse_size:
    description: size of Warehouse in query
    type: string
  pipe_name:
    description: name of snowpipe 
    type: string
  warehouse_name:
    description: name of Warehouse in query
    type: string
  user_name:
    description: username in query
    type: string


# sql query associated with each group of metrics included
metrics:
  # Billing Metrics
  snowflake.billing.cloud_service.sum:
    description: cloud services sum
    unit: credits
    gauge:
      value_type: double
    enabled: true
    attributes: [service_type]
  snowflake.billing.total_credit.sum:
    description: billing total sum 
    unit: credits
    gauge:
      value_type: double
    enabled: true
    attributes: [service_type]
  snowflake.billing.virtual_warehouse.sum:
    enabled: true
    description: compute credits used sum
    attributes: [service_type]
    gauge:
      value_type: double

  # Warehouse Billing Metrics
  snowflake.billing.warehouse.cloud_service.sum:
    description: ware billing for cloud service
    unit: credits
    gauge: 
      value_type: double
    enabled: true
    attributes: [warehouse_name]
  snowflake.billing.warehouse.total_credit.sum:
    description: warehouse total credits
    unit: credits
    gauge: 
      value_type: double
    enabled: true
    attributes: [warehouse_name]
  snowflake.billing.warehouse.virtual_warehouse.sum:
    description: virtual warehouse credits used
    unit: credits
    gauge:
      value_type: double
    enabled: true
    attributes: [warehouse_name]

  # Login (Security) metrics 
  snowflake.logins.total:
    description: total logins
    unit: 1
    gauge:
      value_type: int 
    enabled: true 
    attributes: [error_message, reported_client_type, is_success]

  # High level low dimensionality query metrics 
  snowflake.query.blocked:
    description: number of blocked queries
    unit: 1
    gauge:
      value_type: double
    enabled: true 
    attributes: [warehouse_name]
  snowflake.query.executed:
    description: number of executed queries
    unit: 1
    gauge:
      value_type: double
    enabled: true 
    attributes: [warehouse_name]
  snowflake.query.queued_overload:
    description: queue overload count
    unit: 1
    gauge:
      value_type: double
    enabled: true 
    attributes: [warehouse_name]
  snowflake.query.queued_provision:
    description: queue provision count
    unit: 1
    gauge:
      value_type: double 
    enabled: true 
    attributes: [warehouse_name]

  # DB metrics
  snowflake.database.query.count:
    description: total number of queries
    unit: 1
    gauge:
      value_type: int 
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.database.bytes_scanned.avg:
    description: average bytes scanned
    unit: bytes
    gauge:
      value_type: double
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.query.bytes_scanned.sum:
    description: total bytes scanend
    unit: bytes
    gauge:
      value_type: int 
    enabled: true 
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.query.bytes_deleted.sum:
    description: total bytes bytes deleted 
    unit: bytes 
    gauge:
      value_type: int 
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.query.bytes_spilled.local.sum:
    description: total bytes spilled 
    unit: bytes 
    gauge:
      value_type: int
    enabled: true 
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.query.bytes_spilled.remote.sum:
    description: remote bytes spilled
    unit: bytes 
    gauge:
      value_type: int
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.query.bytes_written.sum:
    description: total bytes bytes
    unit: bytes 
    gauge: 
      value_type: int
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.query.compilation_time.sum:
    description: total compilation time
    unit: s 
    gauge:
      # maybe int, unclear
      value_type: double
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.query.data_scanned_cache.avg:
    description: average data scanned cache 
    unit: 1
    gauge:
      value_type: double
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.query.execution_time.sum:
    description: query execution time 
    unit: s 
    gauge: 
      value_type: double
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.query.partitions_scanned.sum:
    description: number of partitions scanned 
    unit: 1
    gauge:
      value_type: int
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.queued_overload_time.avg:
    description: average queued overload time 
    unit: s 
    gauge: 
      value_type: double
    enabled: true 
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.queued_overload_time.sum:
    description: total queued overload time 
    unit: s 
    gauge: 
      value_type: int
    enabled: true 
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.queued_provisioning_time.avg:
    description: average queued provisioning time
    unit: s 
    gauge:
      value_type: double
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.queued_provisioning_time.sum:
    description: total queued provisioning time
    unit: s 
    gauge:
      value_type: int
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.queued_repair_time.sum:
    description: total queued repair time
    unit: s 
    gauge:
      value_type: int
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.queued_repair_time.avg:
    description: average queued repair time
    unit: s 
    gauge:
      value_type: double
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.rows_inserted.sum:
    description: rows inserted
    unit: rows
    gauge:
      value_type: int
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.rows_deleted.sum:
    description: rows deleted
    unit: rows 
    gauge:
      value_type: int
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.rows_produced.sum:
    description: rows produced
    unit: rows 
    gauge:
      value_type: int
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.rows_unloaded.sum:
    description: rows unloaded
    unit: rows 
    gauge:
      value_type: int
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.rows_updated.sum:
    description: rows updated
    unit: rows 
    gauge:
      value_type: int
    enabled: true
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.total_elapsed_time.sum:
    description: total elapsed time
    unit: s 
    gauge:
      value_type: int 
    enabled: true 
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]
  snowflake.total_elapsed_time.avg:
    description: average elapsed time
    unit: s 
    gauge:
      value_type: double 
    enabled: true 
    attributes: [schema_name, execution_status, error_message, query_type, warehouse_name, database_name, warehouse_size]

  # Session metric 
  snowflake.session_id.count:
    description: distinct session ids
    unit: 1
    gauge:
      value_type: int
    enabled: true
    attributes: [user_name]
  
  # Snowpipe usage metrics
  snowflake.pipe.credits_used.sum:
    description: snow pipe credits consumed
    unit: credits
    gauge:
      value_type: double
    enabled: true
    attributes: [pipe_name]

  # Storage usage metrics 
  snowflake.storage.storage_bytes.total:
    description: total storage bytes in snowflake
    unit: bytes
    gauge:
      value_type: int
    enabled: true
  snowflake.storage.stage_bytes.total:
    description: total stage bytes in snowflake
    unit: bytes
    gauge:
      value_type: int
    enabled: true
  snowflake.storage.failsafe_bytes.total:
    description: total failsafe bytes in snowflake
    unit: bytes
    gauge:
      value_type: int
    enabled: true

