# receiver_creator
This receiver can instantiate other receivers at runtime based on whether observed endpoints match a configured rule. These rules are evaluated for each endpoint discovered. If the rule evaluates to true then the receiver for that rule will be started against the matched endpoint.

## Config
**status_addr**

Optional `host:port` to listen on for retrieving status info. The full URL is `http://host:port/status`.

**watch_observers**

A list of observers previously defined to be run in the `extensions` section. receiver_creator will watch for endpoints generated by these observers.

**receivers**

A map of receiver names (e.g. `redis/1`) to a template for when and how to instantiate that receiver.

**receivers.&lt;receiver_type/id&gt;.rule**

Rule string using [expvar syntax](https://github.com/antonmedv/expr/blob/master/docs/Language-Definition.md). Variables available are detailed below in [Endpoints](#endpoints).

Each rule must start with `type.(pod|port) &&` such that the rule matches only one endpoint type.

**receivers.&lt;receiver_type/id&gt;.config**

This is static configuration that will be used when creating the receiver at runtime. This config is merged with the config discovered at runtime.

## Endpoints
Depending on the type of endpoint it will have different variables available.

### Pod
| Variable  | Description                  |
|-----------|------------------------------|
| type.pod  | `true`                       |
| name      | name of the pod              |
| labels    | map of labels set on the pod |

### Port
| Variable   | Description                     |
|------------|---------------------------------|
| type.port  | `true`                          |
| name       | container port name             |
| port       | port number                     |
| pod.name   | name of the owning pod          |
| pod.labels | map of labels of the owning pod |
| protocol   | "TCP" or "UDP"                  |

## Example
```yaml
extensions:
  # Configures the Kubernetes observer to watch for pod start and stop events.
  k8s_observer:

receivers:
  receiver_creator/1:
    # Name of the extensions to watch for endpoints to start and stop.
    watch_observers: [k8s_observer]
    receivers:
        redis/1:
          # If this rule matches an instance of this receiver will be started.
          rule: type.port && port == 6379
          config:
            # Static receiver-specific config.
            password: secret

processors:
  exampleprocessor:

exporters:
  exampleexporter:

service:
  pipelines:
    metrics:
      receivers: [receiver_creator/1]
      processors: [exampleprocessor]
      exporters: [exampleexporter]
```
