version: '3'

networks:
  redis-net:
services:
  redis-node1:
    image: redis:latest
    command: redis-server --appendonly yes --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
    networks:
      - redis-net
    ports:
      - "6379:6379"
  redis-node2:
    image: redis:latest
    command: redis-server --appendonly yes --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
    networks:
      - redis-net
    ports:
      - "6380:6379"
  redis-node3:
    image: redis:latest
    command: redis-server --appendonly yes --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
    networks:
      - redis-net
    ports:
      - "6381:6379"
  redis-node4:
    image: redis:latest
    command: redis-server --appendonly yes --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
    networks:
      - redis-net
    ports:
      - "6382:6379"
  redis-node5:
    image: redis:latest
    command: redis-server --appendonly yes --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
    networks:
      - redis-net
    ports:
      - "6383:6379"
  redis-node6:
    image: redis:latest
    command: redis-server --appendonly yes --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000
    networks:
      - redis-net
    ports:
      - "6384:6379"
  redis-init:
    image: redis:latest
    depends_on:
      - "redis-node1"
      - "redis-node2"
      - "redis-node3"
      - "redis-node4"
      - "redis-node5"
      - "redis-node6"
    command: /bin/bash -c 'yes | redis-cli --cluster create redis-node1:6379 redis-node2:6379 redis-node3:6379 redis-node4:6379 redis-node5:6379 redis-node6:6379 --cluster-replicas 1'
    networks:
      - redis-net
  redis-otel-collector:
    image: otelcontribcol:latest
    depends_on:
      - "redis-init"
    volumes:
      #- ./testdata/integration/otel-config.yaml:/etc/otel-collector-config.yaml
      - ./otel-config.yaml:/etc/otel-collector-config.yaml
    command: ["--config=/etc/otel-collector-config.yaml"]
    networks:
      - redis-net


        
